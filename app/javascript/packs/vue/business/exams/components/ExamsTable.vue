<template lang="pug">
  div
    Loading
    table.table(v-if="!loading")
      thead
        tr
          th(@click="sortSelect('name', 'string')" width="40%")
            .d-inline
              | Name
              b-icon.ml-2(icon='chevron-expand')
          th
            .d-inline
              | Status
              b-icon.ml-2(icon='chevron-expand')
          th(@click="sortSelect('created_at', 'date')").text-right
            .d-inline
              | Date Created
              b-icon.ml-2(icon='chevron-expand')
          th(@click="sortSelect('updated_at', 'date')").text-right
            .d-inline
              | Last Modified
              b-icon.ml-2(icon='chevron-expand')
          th(width="30px")
      tbody
        ExamItem(v-for="item in sortedView" :key="item.id" :item="item")

    .row.h-100(v-if="!loading && exams && !exams.length")
      .col.h-100.text-center
        EmptyState

</template>

<script>
  import Loading from '@/common/Loading/Loading'
  import ExamItem from "./ExamItem"
  import EmptyState from '@/common/EmptyState'

  export default {
    props: {
      exams: {
        type: Array,
        required: false
      }
    },
    components: {
      EmptyState,
      Loading,
      ExamItem,
    },
    data () {
      return {
        sortOptions: {
          field: 'status',
          type: 'number',
          reverse: false
        }
      }
    },
    methods: {
      sortSelect (field, type) {
        const sortOption = this.sortOptions
        if (field === sortOption.field) {
          this.sortOptions.reverse = !sortOption.reverse
          return
        }
        this.sortOptions = {
          field: field,
          type: type,
          reverse: false
        }
      }
    },
    computed: {
      loading() {
        return this.$store.getters.loading;
      },
      sortedView () {
        const sortOption = this.sortOptions
        return this.exams.sort((itemA, itemB)=> {
          if (sortOption.type === 'number') {
            if (sortOption.reverse) {
              return  itemB[sortOption.field] - itemA[sortOption.field]
            }
            return itemA[sortOption.field] - itemB[sortOption.field]
          }
          if (sortOption.type === 'date') {
            const dateA = new Date(itemA[sortOption.field])
            const dateB = new Date(itemB[sortOption.field])
            if (sortOption.reverse) {
              return dateB - dateA
            }
            return dateA - dateB
          }
          if (sortOption.type === 'string') {
            const stringA = itemA[sortOption.field].toLowerCase()
            const stringB = itemB[sortOption.field].toLowerCase()
            if (sortOption.reverse) {
              if (stringA > stringB) {
                return -1
              }
              if (stringA < stringB) {
                return 1
              }
              return 0
            }
            if (stringA < stringB) {
              return -1
            }
            if (stringA > stringB) {
              return 1
            }
            return 0
          }
        })
      }
    }
  }
</script>

<style scoped>
  .link {
    max-width: 400px;
    word-break: break-all;
  }
  .d-inline {
    cursor: pointer;
  }
</style>
