- action_path = @action_path
- remote_business = remote_business ? "@business, " : ""

.bootbox-heading
  .pull-left
    - if params[:action] == "edit"
      | Edit Task
    - if params[:action] == "new"
      | New Task
  - if @occurence
    .pull-right.nav.nav-pills style="margin-top: -4px;"
      label.btn.btn-shadow.noshadow.active.task_occurence_btn OCCURENCE
      label.btn.btn-shadow.noshadow.task_series_btn SERIES

  .clearfix
  hr.m-b-1
= render partial: "business/reminders/form", locals: { reminder: @reminder }
- if @occurence
  = render partial: "business/reminders/form", locals: { reminder: @occurence }
  javascript:
    if (typeof($) != "undefined") {
      $(".new_reminder, .edit_reminder").first().hide();
      $(".task_occurence_btn").on("click", function() {
        $(".new_reminder, .edit_reminder").first().hide();
        $(".new_reminder, .edit_reminder").last().show();
        $(".bootbox-heading .nav-pills label").removeClass("active");
        $(this).addClass("active");
      });
      $(".task_series_btn").on("click", function() {
        $(".new_reminder, .edit_reminder").first().show();
        $(".new_reminder, .edit_reminder").last().hide();
        $(".bootbox-heading .nav-pills label").removeClass("active");
        $(this).addClass("active");
      });
    }
javascript:
  var reactive_reminders = true;
  if (typeof($) != "undefined") {
    $(".new_reminder, .edit_reminder").each(function() {
      patch_reminder_datepickers($(this));
      update_reminder_form($(this));
    });
    patch_js_select($(".new_reminder, .edit_reminder"));

    $(".new_reminder, .edit_reminder").each(function() {
      var _this = this;
      $(this).find("select").on("change", function() {
        update_reminder_form($(_this));
      })
    })

    $(".add_task_btn").on("click", function(e) {
      var formselector = $(e.target).parent().parent();
      e.preventDefault();
      var emptiness = formselector.find("input:visible,select:visible").filter(function() { return !this.value; });
      var end_by = formselector.find(".reminder_end_by input:visible").filter(function() { return !this.value; });
      var repeats = formselector.find(".reminder_repeats select:visible").filter(function() { return !this.value; });
      if ((emptiness.length == 0) || (emptiness.length-end_by.length == 0) || (emptiness.length-repeats.length == 0)) {
        switch(formselector.find("select[name='reminder[repeats]']").val()) {
          case "Daily":
            formselector.find(".reminder_repeat_every").last().remove();
            formselector.find(".reminder_repeat_on, .reminder_on_type").remove();
            break;
          case "Weekly":
            formselector.find(".reminder_repeat_on").first().remove();
            formselector.find(".reminder_repeat_every").last().remove();
            formselector.find(".reminder_on_type").remove();
            break;
          case "Monthly":
            formselector.find(".reminder_repeat_every").last().remove();
            switch(formselector.find("select[name='reminder[on_type]']").val()) {
              case "Day":
                formselector.find(".reminder_repeat_on").last().remove();
                break;
              default:
                formselector.find(".reminder_repeat_on").first().remove();
            }
            break;
          case "Yearly":
            formselector.find(".reminder_repeat_every").first().remove();
            switch(formselector.find("select[name='reminder[on_type]']").val()) {
              case "Day":
                formselector.find(".reminder_repeat_on").last().remove();
                break;
              default:
                formselector.find(".reminder_repeat_on").first().remove();
            }
            break;
        }
        formselector.submit();
      } else {
        emptiness.addClass("form_error");
      }
    })
  }